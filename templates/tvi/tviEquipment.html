{% extends 'index.html' %}



{% block content %}

<style>
        div.ButtonTrans {
            width: 50%; /* Set a fixed width for the element */
            margin: 0 auto; /* Center the element horizontally */
            position: absolute; /* Position the element absolutely */
            top: 20%; /* Move the element down by 50% of its own height */
            left: 50%; /* Move the element right by 50% of its own width */
            transform: translate(-50%, -50%); /* Offset the element by its own width and height */
    }

    div.insertEquipment {
            width: 50%; /* Set a fixed width for the element */
            margin: 0 auto; /* Center the element horizontally */
            position: absolute; /* Position the element absolutely */
            top: 28%; /* Move the element down by 50% of its own height */
            left: 50%; /* Move the element right by 50% of its own width */
            transform: translate(-50%, -50%); /* Offset the element by its own width and height */
    }


    div.diesel {
            width: 50%; /* Set a fixed width for the element */
            margin: 0 auto; /* Center the element horizontally */
            position: absolute; /* Position the element absolutely */
            top: 36%; /* Move the element down by 50% of its own height */
            left: 50%; /* Move the element right by 50% of its own width */
            transform: translate(-50%, -50%); /* Offset the element by its own width and height */
    }


    .fas.fa-trash-alt {
        color: red;
    }
</style>


<body>
    <div class="container">
        <div class="ButtonTrans">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#insertEquipment">
                Add Equipment
            </button>

            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#updateEquipment">
                Update Equipment
            </button>

            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#equipmentTable">
                Equipment List
            </button>

            
        </div>
        <div class="insertEquipment">
            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#insertRentalTrans">
                Insert Rental
            </button>
            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#rentalList">
                Rental List
            </button>
        </div>


        <div class="diesel">
            <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#insertDieselTransaction">
                Insert Diesel
            </button>
            <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#dieselList">
                Diesel List
            </button>
        </div>


        <!-- Modal Insert Equipment -->
        <div class="modal fade" id="insertEquipment" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Equipment</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>

                
                <div class="modal-body">

                
                    <label for="EquipmentID"
                    >Equipment ID</label>
                    
                    <input 
                    type="text"
                    name="equipmentID"
                    id="equipmentID"
                    
                    class="form-control"
                    >


                    <label for="Purchase Date"
                    >Purchase Date</label>
                    
                    <input 
                    type="date"
                    name="purchase_date"
                    id="purchase_date"
                    
                    class="form-control"
                    >

                    <label for="Equipment Discription"
                    >Equipment Discription</label>
                    
                    <input 
                    type="text"
                    name="equipmentDesc"
                    id="equipmentDesc"
                    
                    class="form-control"
                    >

                   

                    <label for="Rental Rate"
                        >Purchase Amount</label>
                        
                        <input 
                        type="number"
                        name="purchase_amount"
                        id="purchase_amount"
                        step="0.01"
                        class="form-control"
                        >

                    <label for="Rental Rate"
                        >Rental Rate</label>
                        
                        <input 
                        type="number"
                        name="rentalRate"
                        id="rentalRate"
                        step="0.01"
                        class="form-control"
                        >

                    <label for="Plate Number"
                        >Plate Number</label>
    
                        <input 
                        type="text"
                        name="plate_number"
                        id="plate_number"
                        class="form-control">

                    <label for="Status"
                    >Status</label>
    
                        <select name="status" id="status"class="form-control">

                            <option value="Operational">Operational</option>
                            <option value="Breakdown">Breakdown</option>
                            <option value="Disposed">Disposed</option>
                    
                        </select> 
                        
                    <label for="Project Site"
                        >Project Site</label>
        
                            <select name="project_site" id="project_site"class="form-control">
    
                                <option value="TVI">TVI</option>
                                <option value="THEO">THEO</option>
                                
                        
                            </select> 
                        
                    <label for="Owner"
                    >Owner</label>
    
                        <select name="owner" id="owner"class="form-control"
                           
                            >
                              <option value="LD Global">LD Global</option>
                              <option value="MVD">MVD</option>
                              <option value="SARI">SARI</option>
                              <option value="Fulcrum">Fulcrum</option>
                      
                        </select> 

                    <label for="Remarks"
                    >Remarks</label>

                        <input 
                        type="text"
                        name="remarks"
                        id="remarks"
                        
                        class="form-control"
                    >

                    
                  
        
                
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" onclick="insertEquipment()" class="btn btn-primary">Save</button>
                <!-- <button type="button" name ="save_button" id="save_button" class="btn btn-success">Save</button> -->
                </div>
            </div>
            </div>
        </div>


        <!-- This for table of Equipment -->

        <div class="modal fade" id="equipmentTable" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog  modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Euipment Table</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>

                
                <div class="modal-body">
                    <div class="container mt-3">
                        <button type="submit" onclick="displayData()" class="btn btn-primary">Display</button>
                    </div>

                    <div  class="container mt-3">
                        <table id="myTable" class="table table-bordered"  style="text-align: center;">
                            <thead class="table-dark">
                            
                                    <td>ID</td>
                                    <td>Equipment ID</td>
                                    <td>Purchase Date</td>
                                    <td>Equipment Description</td>
                                    <td>Purchase amount</td>
                                    <td>Plate No.</td>
                                    <td>Rental Rate</td>
                                    <td>Status</td>
                                    <td>Project</td>
                                    <td>Remarks</td>
                                    <td>Owner</td>
                                   
                                    
                                </tr>
                            </thead>
                            <tbody id="table_body">
                               
                                    
                                    <tr>
                                        
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        
                                    </tr>
                                   
                                
                            </tbody>
            
                           
            
                        </table>
            
                        
                            
                            
                    </div>
        
                  
           </div>
        

                   
        
                
                </div>
                <div class="modal-footer">
                
                <!-- <button type="button" name ="save_button" id="save_button" class="btn btn-success">Save</button> -->
                </div>
            </div>
            </div>
        </div>


        <!-- Modal -->
        <div class="modal fade" id="updateEquipment" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Update Equipment</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>

                
                <div class="modal-body">

                    <label for="transID"
                    >Trans ID</label>
                    
                    <input 
                    type="text"
                    name="transID"
                    id="transID"
                    required
                    
                    >

                    <button type="submit"  onclick="dislayDataEquipment()" class="btn btn-success">
                        Search 
                        <i class="fas fa-database"></i>
                    </button>

                    <br>
                    
                    <label for="EquipmentID"
                    >Equipment ID</label>
                    
                    <input 
                    type="text"
                    name="equipmentID_up"
                    id="equipmentID_up"
                    
                    class="form-control"
                    >


                    <label for="Purchase Date"
                    >Purchase Date</label>
                    
                    <input 
                    type="date"
                    name="purchase_date_up"
                    id="purchase_date_up"
                    
                    class="form-control"
                    >

                    <label for="Equipment Discription"
                    >Equipment Discription</label>
                    
                    <input 
                    type="text"
                    name="equipmentDesc_up"
                    id="equipmentDesc_up"
                    
                    class="form-control"
                    >

                   

                    <label for="Rental Rate"
                        >Purchase Amount</label>
                        
                        <input 
                        type="number"
                        name="purchase_amount_up"
                        id="purchase_amount_up"
                        step="0.01"
                        class="form-control"
                        >

                    <label for="Rental Rate"
                        >Rental Rate</label>
                        
                        <input 
                        type="number"
                        name="rentalRate_up"
                        id="rentalRate_up"
                        step="0.01"
                        class="form-control"
                        >

                    <label for="Plate Number"
                        >Plate Number</label>
    
                        <input 
                        type="text"
                        name="plate_number_up"
                        id="plate_number_up"
                        class="form-control">

                    <label for="Status"
                    >Status</label>
    
                        <select name="status" id="status_up"class="form-control">

                            <option value="Operational">Operational</option>
                            <option value="Breakdown">Breakdown</option>
                            <option value="Disposed">Disposed</option>
                    
                        </select> 
                    
                    <label for="Project Site"
                    >Project Site</label>
    
                        <select name="project_site_up" id="project_site_up"class="form-control">

                            <option value="TVI">TVI</option>
                            <option value="THEO">THEO</option>
                            
                    
                        </select> 
                    

                    <label for="Owner"
                    >Owner</label>
    
                        <select name="owner" id="owner_up"class="form-control"
                           
                            >
                              <option value="LD Global">LD Global</option>
                              <option value="MVD">MVD</option>
                              <option value="SARI">SARI</option>
                              <option value="Fulcrum">Fulcrum</option>
                      
                        </select> 

                    <label for="Remarks"
                    >Remarks</label>

                        <input 
                        type="text"
                        name="remarks_up"
                        id="remarks_up"
                        
                        class="form-control"
                    >

                
                    
                  
                    
        
                
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" onclick="update_equipment()" class="btn btn-primary">Update</button>
                <!-- <button type="button" name ="save_button" id="save_button" class="btn btn-success">Save</button> -->
                </div>
            </div>
            </div>
        </div>


        <!-- Modal insert Rental Transaction -->
        <div class="modal fade" id="insertRentalTrans" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Insert Rental</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>

                
                <div class="modal-body">

                    <label for="transDate"
                    >Trans Date</label>
                    
                    <input 
                    type="date"
                    name="transactionDateRentTrans"
                    id="transactionDateRentTrans"
                    class="form-control"
                    >

                    <label for="transID"
                    >Equipment ID</label>
                    
                    <br>
                    <input 
                    type="text"
                    name="equipmentIdRent"
                    id="equipmentIdRent"
                  
                    
                    >

                    <button type="submit"  onclick="dislayRentalRate()" class="btn btn-success">
                        Search 
                        <i class="fas fa-database"></i>
                    </button>

                    <br>
                    
                    
                
                    <label for="Total Hours"
                    >Total Hours</label>
                    
                    <input 
                    type="number"
                    name="totalHoursRentalTrans"
                    id="totalHoursRentalTrans"
                    step="0.01"
                    class="form-control"
                    >

                   

                    <label for="Rental Rate"
                        >Rental Rate</label>
                        
                        <input 
                        type="number"
                        name="rentalRateTransaction"
                        id="rentalRateTransaction"
                        step="0.01"
                        class="form-control"
                        >
                    
                    <label for="Total Amount"
                        >Gross Amount</label>
                        
                        <input 
                        type="number"
                        name="grossAmountTransaction"
                        id="grossAmountTransaction"
                        step="0.01"
                        class="form-control"
                        >

                    <label for="Tax Rate"
                        >Tax Rate</label>
                        
                        <input 
                        type="number"
                        name="taxRateTransaction"
                        id="taxRateTransaction"
                        step="0.01"
                        class="form-control"
                        >


                    <label for="Vat Output"
                        >Vat Output</label>
                        
                        <input 
                        type="number"
                        name="vatOutputRentalTrans"
                        id="vatOutputRentalTrans"
                        step="0.01"
                        class="form-control"
                        >

                    <label for="NetofVat"
                        >Net of VAt</label>
                        
                        <input 
                        type="number"
                        name="netOfVAtRentalTrans"
                        id="netOfVAtRentalTrans"
                        step="0.01"
                        class="form-control"
                        >

                    <label for="driverOperator"
                        >Driver/Operator</label>
                        
                        <input 
                        type="text"
                        name="driverOperatorRentaltrans"
                        id="driverOperatorRentaltrans"
                        
                        class="form-control"
                        >



                    

                    
                    
                    <br>
                    
        
                
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" onclick="insertRentalTrans()" class="btn btn-primary">Save</button>
                <!-- <button type="button" name ="save_button" id="save_button" class="btn btn-success">Save</button> -->
                </div>
            </div>
            </div>
        </div>


        <!-- This for table of Equipment -->

        <div class="modal fade" id="rentalList" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog  modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Euipment Table</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>

                
                <div class="modal-body">
                    <div class="container mt-3">
                        <label for="dateFrom"
                        >From</label>
                        
                            <input 
                            type="date"
                            name="dateFromRentTrans"
                            id="dateFromRentTrans"
                           
                            >

                    
                        <label for="dateTo"
                        >To</label>
                        
                            <input 
                            type="date"
                            name="dateToRentTrans"
                            id="dateToRentTrans"
                           
                            >
                        <label for="Equipment"
                            >Equipment</label>
                            <input 
                            type="text"
                            name="equipmentSearchRentTrans"
                            id="equipmentSearchRentTrans"
                            
                            >
                        
                        <button type="submit" onclick="displayRentalData()" class="btn btn-primary">Search</button>

                        <button type="submit"  onclick="html_table_excel('xlsx')" class="btn btn-secondary">
                            Export Excel
                            <i class="fas fa-database"></i>
                        </button>
                    </div>

                    <div  class="container mt-3">
                        <table id="myTable" class="table table-bordered"  style="text-align: center;">
                            <thead class="table-dark">
                            
                                    <td>ID</td>
                                    <td>Trans Date</td>
                                    <td>Equipment ID</td>
                                    <td>Total Hour</td>
                                    <td>Rental Rate</td>
                                    <td>Total Amount</td>
                                    <td>Tax Rate</td>
                                    <td>VAT output</td>
                                    <td>Net of Vat</td>
                                    <td>Driver</td>
                                    <td>Action</td>
                                </tr>
                            </thead>
                            <tbody id="table_body2">
                               
                                    
                                    <tr>
                                        
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                   
                                
                            </tbody>
            
                           
            
                        </table>
            
                        
                            
                            
                    </div>
        
                  
           </div>
        

                   
        
                
                </div>
                <div class="modal-footer">
                
                <!-- <button type="button" name ="save_button" id="save_button" class="btn btn-success">Save</button> -->
                </div>
            </div>
            </div>
        </div>



        <!-- Modal Insert Diesel Transactions -->
        <div class="modal fade" id="insertDieselTransaction" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Diesel Transaction</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>

                
                <div class="modal-body">

                    <label for="TransactionDate"
                    >TransactionDate</label>
                    
                    <input 
                    type="date"
                    name="transDateDiesel"
                    id="transDateDiesel"
                    
                    class="form-control"
                    >

                
                    <label for="EquipmentID"
                    >Equipment ID</label>
                    
                    <input 
                    type="text"
                    name="equipmentIdDiesel"
                    id="equipmentIdDiesel"
                    
                    class="form-control"
                    >


                    

                    <label for="WithSlpi"
                    >Withdrawal Slip</label>
                    
                    <input 
                    type="text"
                    name="withdrawalSlipDiesel"
                    id="withdrawalSlipDiesel"
                    
                    class="form-control"
                    >

                   

                    <label for="TotalLiters"
                        >Total Liters</label>
                        
                        <input 
                        type="number"
                        name="totalliters"
                        id="totalliters"
                        step="0.01"
                        class="form-control"
                        >

                    <label for="Price"
                        >Price</label>
                        
                        <input 
                        type="number"
                        name="priceDiesel"
                        id="priceDiesel"
                        step="0.01"
                        class="form-control"
                        >

                    <label for="Plate Number"
                        >Total Amount</label>
    
                        <input 
                        type="number"
                        name="totalAmountDiesel"
                        id="totalAmountDiesel"
                        step="0.01"
                        class="form-control">

                    
                  
        
                
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" onclick="insertDiesel()" class="btn btn-primary">Save</button>
                <!-- <button type="button" name ="save_button" id="save_button" class="btn btn-success">Save</button> -->
                </div>
            </div>
            </div>
        </div>


        <!-- This for table of Diesel Transaction -->

        <div class="modal fade" id="dieselList" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog  modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Diesel Transaction List</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>

                
                <div class="modal-body">
                    <div class="container mt-3">
                        <label for="dateFrom"
                        >From</label>
                        
                            <input 
                            type="date"
                            name="dateFromDiesel"
                            id="dateFromDiesel"
                           
                            >

                    
                        <label for="dateTo"
                        >To</label>
                        
                            <input 
                            type="date"
                            name="dateToDiesel"
                            id="dateToDiesel"
                           
                            >
                        <label for="Equipment"
                            >Equipment</label>
                            <input 
                            type="text"
                            name="equipmentSearchDieselTrans"
                            id="equipmentSearchDieselTrans"
                            
                            >
                        
                        <button type="submit" onclick="displayDieselData()" class="btn btn-primary">Search</button>

                        <button type="submit"  onclick="html_table_excel('xlsx')" class="btn btn-secondary">
                            Export Excel
                            <i class="fas fa-database"></i>
                        </button>
                    </div>

                    <div  class="container mt-3">
                        <table id="myTableDiesel" class="table table-bordered"  style="text-align: center;">
                            <thead class="table-dark">
                            
                                    <td>ID</td>
                                    <td>Trans Date</td>
                                    <td>Equipment ID</td>
                                    <td>Withdrawal Slip</td>
                                    <td>Liters</td>
                                    <td>Price</td>
                                    <td>Total Amount</td>
                                    <td>Action</td>
                                </tr>
                            </thead>
                            <tbody id="table_body_diesel">
                               
                                    
                                    <tr>
                                        
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                      
                                    </tr>
                                   
                                
                            </tbody>
            
                           
            
                        </table>
            
                        
                            
                            
                    </div>
        
                  
           </div>
        

                   
        
                
                </div>
                <div class="modal-footer">
                
                <!-- <button type="button" name ="save_button" id="save_button" class="btn btn-success">Save</button> -->
                </div>
            </div>
            </div>
        </div>









    </div>

    <!-- This is to insert Equipment to tvi table -->
    <script type="text/javascript">
        // Define an async function to insert equipment
        async function insertEquipment() {
          // Get the values of the input fields
          const data = {
            equipmentID: document.getElementById("equipmentID").value,
            purchase_date: document.getElementById("purchase_date").value,
            equipmentDesc: document.getElementById("equipmentDesc").value,
            purchase_amount: document.getElementById("purchase_amount").value,
            rentalRate: document.getElementById("rentalRate").value,
            plate_number: document.getElementById("plate_number").value,
            status: document.getElementById("status").value,
            project_site: document.getElementById("project_site").value,
            remarks: document.getElementById("remarks").value,
            owner: document.getElementById("owner").value

          };
      
          // Use the fetch API to send the POST request
          try { 
            // var equipmentID = document.getElementById("equipmentID").value

            // const search_url = `/api-searchID-tiv-equipment/?equipmentID=${equipmentID}`;


            // const responce = await fetch(search_url)
            // const data = await responce.json();
            // console.log(data)
            

            // if (data.length != 0) 
            

                const response = await fetch(`/api-insert-tvi-equipment-sqlModel/`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
                });
        
                // Check if the response was successful
                if (response.status === 200) {
                window.alert("Your data has been saved");
                window.location.assign("/tvi-transaction/");
                console.log(response.json());
                } else if (response.status === 401) {
                window.alert("Unauthorized credential. Please login");
                }else{
                    window.alert("Equipment ID is already Taken"); 
                }
                    
               
           
          } catch (error) {
            // Catch any errors and log them to the console
            window.alert(error);
            console.log(error);
          }
        }
      </script>

    <!-- This function is for displaying Equipment Data -->

    <script type="text/javascript">
         // const rental_url =search_url ;
         async function displayData(){
            
            const search_url = `/api-get-tvi-equipment-sqlModel/`;


            const responce = await fetch(search_url)
            const data = await responce.json();
            console.log(data)
            
            
            
            let tableData="";
            data.map((values)=>{
                tableData+= ` <tr>
                            <td>${values.id}</td>
                            <td>${values.equipmentID}</td>
                            <td>${values.purchase_date}</td>
                            <td>${values.equipmentDesc}</td>
                            <td>${values.purchase_amount}</td>
                            <td>${values.rentalRate}</td>
                            <td>${values.plate_number}</td>
                            <td>${values.status}</td>
                            <td>${values.project_site}</td>
                            <td>${values.remarks}</td>
                            
                            <td>${values.owner}</td>
                           
                          
                            
                        
                        </tr>`;
            });
            document.getElementById("table_body").innerHTML=tableData;
        }
        
      
        
    </script>



    <!-- This is for displaying equipment  using ID of Transaction -->
    <script type="text/javascript">

            //         // Function to display data for the equipment with the given ID
            async function dislayDataEquipment() {
                // Get the equipment ID from the input field
                var transid = document.getElementById("transID").value

                // Construct the API URL using the equipment ID
                var search_url = `/api-searchID-tiv-equipment/?id=${transid}`;

                try {
                // Call the API using the fetch API
                var responce = await fetch(search_url)
                var data = await responce.json();
                console.log(data)
                // Check if the API call was successful
                if (responce.status === 404) {
                    window.alert(`No transaction ID ${transid}`)
                
                } else if (data.length === 0) {
                window.alert(`No ID store for ${transid}`);
                }
                
                else if (responce.status == 200) {
                    // Get the data for the equipment
                    var equipmentID = data[0].equipmentID
                    var purchase_date = data[0].purchase_date
                    var equipmentDesc = data[0].equipmentDesc
                    var purchase_amount = data[0].purchase_amount
                    var rentalRate = data[0].rentalRate
                    var plate_number = data[0].plate_number
                    var status = data[0].status
                    var status = data[0].project_site
                    var remarks = data[0].remarks
                    var owner = data[0].owner
                    

                    // Update the input fields with the equipment data
                    document.getElementById("equipmentID_up").value = equipmentID;
                    document.getElementById("purchase_date_up").value = purchase_date;
                    document.getElementById("equipmentDesc_up").value = equipmentDesc;
                    document.getElementById("purchase_amount_up").value = purchase_amount;
                    document.getElementById("rentalRate_up").value = rentalRate;
                    document.getElementById("plate_number_up").value = plate_number;
                    document.getElementById("status_up").value = status;
                    document.getElementById("project_site").value = status;
                    document.getElementById("remarks_up").value = remarks;
                    document.getElementById("owner_up").value = owner;


                } else if (responce.status == 422){
                    window.alert(`Trans ID ${transid} is not Integer`)
                }
                } catch (error) {
                // Handle any errors that occurred in the fetch call
                console.error(error)
                window.alert("Error occurred while fetching data")
                }
            }

    </script>


    <script type="text/javascript">
        function update_equipment() {
            var data = {};
            var id = document.getElementById("transID").value;
            data["equipmentID"] = document.getElementById("equipmentID_up").value;
            data["purchase_date"] = document.getElementById("purchase_date_up").value;
            data["equipmentDesc"] = document.getElementById("equipmentDesc_up").value;
            data["purchase_amount"] = document.getElementById("purchase_amount_up").value;
            data["rentalRate"] = document.getElementById("rentalRate_up").value;
            data["plate_number"] = document.getElementById("plate_number_up").value;
            data["status"] = document.getElementById("status_up").value;
            data["project_site"] = document.getElementById("project_site_up").value;
            data["remarks"] = document.getElementById("remarks_up").value;
            data["owner"] = document.getElementById("owner_up").value;

            console.log(data);

            if (id === '') {
                window.alert("Trans ID field is requires");
            } else {
                // Use async/await to simplify the fetch call
                (async () => {
                    try {
                        // Use template literals to build the URL
                        const response = await fetch(`/api-update-tvi-equipment-sqlModel/?id=${id}`, {
                            method: "PUT",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(data)
                        });

                        // Use response.ok to check if the response was successful
                        if (response.ok) {
                            window.alert("Your Data has been Updated");
                            window.location.assign("/tvi-transaction/");
                            console.log(await response.json());
                        } else if (response.status === 401) {
                            window.alert("Unauthorized credential Please Login");
                        }
                    } catch (error) {
                        // Catch errors
                        window.alert(error);
                        console.log(error);
                    }
                })();
            }
        }
    </script>


    <!-- This is for auto complete of Equipment ID -->
    <script>
        $( function() { 
                    $("#equipmentIdRent").autocomplete({
                    source: "/api-search-autocomplete-tvi-equipment2/"
                    });

                } );

    </script>

    <!-- This function mis for automatic display of rental Rate -->

    <script type="text/javascript">


        // equipmentID = document.getElementById('equipmentIdRent').value;
        async function dislayRentalRate() {
        try {
            equipmentID = document.getElementById('equipmentIdRent').value;
            // Construct the API URL using a template string
            const searchUrl = `/api-search-tvi-equipmentID/?term=${equipmentID}`;

            // Call the API using the fetch API
            const responce = await fetch(searchUrl);
            const data = await responce.json();
            console.log(data)
            // Check if the API call was successful
            if (!responce.ok) {
            window.alert("Unauthorized Please Login");
            }

            // Check if any data was returned
            if (data.length === 0) {
            window.alert(`No ID store for ${equipmentID}`);
            } else {
            // Get the data for the equipment
            const rentalRate = data[0].rentalRate;
            const owner = data[0].owner;

            // Update the input fields with the equipment data

            
            document.getElementById("rentalRateTransaction").value = rentalRate;
            
        


            }
        } 
        
        
        catch (error) {
            // Handle any errors that occurred in the fetch call
            console.error(error);
            window.alert("Error occurred while fetching data");
        }
        }

    </script>





    

            <!-- <script>
                $("#equipmentIdRent").autocomplete({
                source: function (request,response){
                    $.ajax({
                        url: `/api-search-autocomplete-tvi-equipment2/`,
                        dataType: "json",
                        data: {term: request.term},
                        success: function(data) {
                        console.log(data) 
                            response ($.filter(data, function(item){
                                return {
                                    value: item.equipmentID,
                                    // id: item.id_productID,
                                    // brand: item.brand_purchases,
                                    // description: item.descriptions_pruchases,
                                    // price: item.price_purchases,
                                    // unit: item.unit_purchases,
                                    // category: item.category_purchases
                                    
                                }
                            }))
                        },
                            error: function(e){
                            console.log(e)
                        }
                    });
                },
                select: function(event, ui){
                    $(this).val(ui.item.value);
                    // $('#id_productID').val(ui.item.id);
                    // $('#brand_purchases').val(ui.item.brand);
                    // $('#descriptions_pruchases').val(ui.item.description);
                    // $('#price_purchases').val(ui.item.price);
                    // $('#unit_purchases').val(ui.item.unit)
                    // $('#category_purchases').val(ui.item.category)
                    
                    
                },
                minLength: 2
            }); 
            </script> -->

    <!-- This is for  computation of Gross Amount -->
    <script type="text/javascript">
        const totalHoursElement = document.getElementById('totalHoursRentalTrans');
        const rentalRateElement = document.getElementById('rentalRateTransaction');
        const grossAmountElement = document.getElementById('grossAmountTransaction');

        totalHoursElement.addEventListener('input', updateGrossAmount);
        rentalRateElement.addEventListener('input', updateGrossAmount);

        function updateGrossAmount() {
        const totalHours = Number(totalHoursElement.value);
        const rentalRate = Number(rentalRateElement.value);

        if (isNaN(totalHours) || isNaN(rentalRate)) {
            grossAmountElement.value = '';
            return;
        }

        const grossAmount = calculateGrossAmount(totalHours, rentalRate);
        grossAmountElement.value = grossAmount.toFixed(2);
        }

        function calculateGrossAmount(totalHours, rentalRate) {
        return totalHours * rentalRate;
        }
    </script>


    <!-- This is for  computation of Vat Output  and Net of Vat-->
    <script type="text/javascript">
        const grossAmountInput = document.getElementById('grossAmountTransaction');
        const taxRateElement = document.getElementById('taxRateTransaction');
        const vatOutputElement = document.getElementById('vatOutputRentalTrans');
        const netOfVatElement = document.getElementById('netOfVAtRentalTrans');

        grossAmountInput.addEventListener('input', updateVatAmount);
        taxRateElement.addEventListener('input', updateVatAmount);
        grossAmountInput.addEventListener('input', updateVatAmount);

        function updateVatAmount() {
        const totalgross = Number(grossAmountInput.value);
        const taxRate = Number(taxRateElement.value);
        const vatOutputCal = Number(vatOutputElement.value);

        if (isNaN(totalgross) || isNaN(taxRate)) {
            vatOutputElement.value = '';
            return;
        }

        const vatOutput = calculateVatOutput(totalgross, taxRate);
        vatOutputElement.value = vatOutput.toFixed(2);

        const netOfVat = calculatenetOfVat(totalgross, vatOutputCal);
        netOfVatElement.value = netOfVat.toFixed(2);

        
        }

    
        function calculateVatOutput(totalgross, taxRate) {
        return (totalgross/1.12) * taxRate;
        }


        function calculatenetOfVat(totalgross, vatOutputCal) {
        return totalgross /1.12;
        }
    </script>

     <!-- This is to insert Equipment Rental DATA to tvi table -->
     <script type="text/javascript">
        // Define an async function to insert equipment
        async function insertRentalTrans() {
          // Get the values of the input fields
          var vat_output = document.getElementById("vatOutputRentalTrans").value;
          var taxRate =document.getElementById("netOfVAtRentalTrans").value;
          var transDate = document.getElementById("transactionDateRentTrans").value;
          console.log(vat_output,taxRate,transDate)
          const data = {
            transDate: document.getElementById("transactionDateRentTrans").value,
            equipmentId: document.getElementById("equipmentIdRent").value,
            totalHours: document.getElementById("totalHoursRentalTrans").value,
            rentalRate: document.getElementById("rentalRateTransaction").value,
            totalAmount: document.getElementById("grossAmountTransaction").value,
            taxRate: document.getElementById("taxRateTransaction").value,
            vat_output: document.getElementById("vatOutputRentalTrans").value,
            net_of_vat: document.getElementById("netOfVAtRentalTrans").value,
            driverOperator: document.getElementById("driverOperatorRentaltrans").value,
            
            
          };
      
          // Use the fetch API to send the POST request
          try {
            const response = await fetch(`/api-insert-tvi-rental-sqlModel/`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data)
            });
      
            // Check if the response was successful
            if (response.status === 200) {
              window.alert("Your data has been saved");
              console.log(data);
              window.location.assign("/tvi-transaction/");
              
            } else if (response.status === 401) {
              window.alert("Unauthorized credential. Please login");
            }
          } catch (error) {
            // Catch any errors and log them to the console
            window.alert(error);
            console.log(error);
          }
        }
      </script>

     <!-- This function is for displaying Rental Data -->

        <script type="text/javascript">
            // const rental_url =search_url ;
            async function displayRentalData(){
                var datefrom = document.getElementById('dateFromRentTrans').value;
                var dateto = document.getElementById('dateToRentTrans').value;
                var equipmentID = document.getElementById('equipmentSearchRentTrans').value;
                
            const search_url = `/api-get-tvi-all-rentalTransaction-sqlModel/?datefrom=${datefrom}&dateto=${dateto}
                                &equipmentId=${equipmentID}`;

            
            const responce = await fetch(search_url)
            const data = await responce.json();
            console.log(data)
            
            if (responce.status === 200) {
                let tableData2="";
                data.map((values)=>{
                    tableData2+= ` <tr>
                                <td>${values.id}</td>
                                <td>${values.transDate}</td>
                                <td>${values.equipmentId}</td>
                                <td>${values.totalHours}</td>
                                <td>${values.rentalRate}</td>
                                <td>${values.totalAmount}</td>
                                <td>${values.taxRate}</td>
                                <td>${values.vat_output}</td>
                                <td>${values.net_of_vat}</td>
                                <td>${values.driverOperator}</td>
                                
                            
                                
                                <td>
                                    <a href="/api-get-update-tvi-rentalTransaction-sqlModel/${values.id}"
                                    <button type="button" class="btn btn-primary">
                                    <i class="fas fa-database"></i> Edit</button></a> 

                                    <button type="button"  id="remove_button" onclick="delete_rental(${values.id})" 
                                            <i class="btn btn-danger">
                                            </i>Del</button>

                                           
                                </td>

                               

                               
                               
                            
                            </tr>`;
                });
                    document.getElementById("table_body2").innerHTML=tableData2;
                }else if (responce.status === 401){
                    window.alert("Unauthorized credential. Please login");
                }
            
            }
            
            
        
        
        </script>


        <script type="text/javascript">
            function delete_rental_transactions(id) {
            if (confirm('Are you sure you want to delete this rental transaction?')) {
                fetch(`/api-deletetiv-rental/${id}`, {
                method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                    alert('Your data has been deleted');
                    window.location.assign('/tvi-transaction/');
                    } else {
                    throw new Error('Failed to delete data');
                    }
                })
                .catch(error => {
                    alert(error.message);
                });
            }
            }
        </script>




    <!-- this function is for exporting Excel -->
        <script>
            function html_table_excel(type){
                var data = document.getElementById('table_body2');
                var file = XLSX.utils.table_to_book(data,{sheet: "sheet1"});
                XLSX.write(file,{ booktype: type, bookSST: true, type: 'base64'});
                XLSX.writeFile(file, 'rental.' + type);

            }

            
        </script>

<!-- ------------------------------This line of Script is for Diesel Transaction--------------------------- -->

            <!-- This is for auto complete of Equipment ID -->
            <script>
                $( function() { 
                            $("#equipmentIdDiesel").autocomplete({
                            source: "/api-search-autocomplete-tvi-equipment2/"
                            });

                        } );

            </script>

            <script>

                    $(document).ready(function() {
                    $('#totalliters, #priceDiesel').on('input', function() {
                        calculateProduct();
                    });
                    });

                    function calculateProduct() {
                    var input1 = $('#totalliters').val();
                    var input2 = $('#priceDiesel').val();
                    var product = input1 * input2;

                    product2 = product.toFixed(2)
                    $('#totalAmountDiesel').val(product2);
                    }


            </script>


            <!-- This is to insert Equipment Rental DATA to tvi table -->
            <script type="text/javascript">
                // Define an async function to insert equipment
                async function insertDiesel() {
                // Get the values of the input fields
               
                const data = {
                    transDate: document.getElementById("transDateDiesel").value,
                    equipmentId: document.getElementById("equipmentIdDiesel").value,
                    withdrawalSlip: document.getElementById("withdrawalSlipDiesel").value,
                    totalliters: document.getElementById("totalliters").value,
                    price: document.getElementById("priceDiesel").value,
                    totalAmount: document.getElementById("totalAmountDiesel").value,
                   
                    
                    
                };
            
                // Use the fetch API to send the POST request
                try {

                    const search_url_SEARCH = `/api-search-tvi-diesel-withDrawalSlip/?withdrawalSlip=${data.withdrawalSlip}`;


                    const responceSEARCH = await fetch(search_url_SEARCH)
                    const dataSEARCH = await responceSEARCH.json();
                    console.log(dataSEARCH)

                    if (dataSEARCH.length > 0) {
                        window.alert("Your data has already EXIST please check Diesel List");
                    }else{
                        const response = await fetch(`/api-insert-tvi-diesel-sqlModel/`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                    });
            
                    // Check if the response was successful
                    if (response.status === 200) {
                    window.alert("Your data has been saved");
                    console.log(data);
                    window.location.assign("/tvi-transaction/");
                    
                    } else if (response.status === 401) {
                    window.alert("Unauthorized credential. Please login");
                    }

                    }
                    
                   
                } catch (error) {
                    // Catch any errors and log them to the console
                    window.alert(error);
                    console.log(error);
                }
                }
            </script>


            <!-- This function is for displaying Rental Data -->

            <script type="text/javascript">
                // const rental_url =search_url ;
                async function displayDieselData(){
                    var datefrom = document.getElementById('dateFromDiesel').value;
                    var dateto = document.getElementById('dateToDiesel').value;
                    var equipmentID = document.getElementById('equipmentSearchRentTrans').value;
                    
                const search_url = `/api-search-tvi-diesel-trans/?datefrom=${datefrom}&dateto=${dateto}
                                    &equipmentId=${equipmentID}`;

                
                const responce = await fetch(search_url)
                const data = await responce.json();
                console.log(data)
                
                if (responce.status === 200) {
                    let tableData2="";
                    data.map((values)=>{
                        tableData2+= ` <tr>
                                    <td>${values.id}</td>
                                    <td>${values.transDate}</td>
                                    <td>${values.equipmentId}</td>
                                    <td>${values.withdrawalSlip}</td>
                                    <td>${values.totalliters}</td>
                                    <td>${values.price}</td>
                                    <td>${values.totalAmount}</td>
                                    
                                    
                                
                                    
                                    <td>
                                        <a href="/api-get-update-tvi-dieselTrans-sqlModel/${values.id}"
                                        <button type="button" class="btn btn-primary">
                                        <i class="fas fa-database"></i> Edit</button></a> 
                                    </td>

                                
                                
                                
                                </tr>`;
                    });
                        document.getElementById("table_body_diesel").innerHTML=tableData2;
                    }else if (responce.status === 401){
                        window.alert("Unauthorized credential. Please login");
                    }
                
                }
                
                


            </script>

<script src="/static/tvi.js"></script>
   
      
</body>

{% endblock %}
